<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sevgili BaÅŸvuru Formu â€” Sunum</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700;900&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg-1:#0b0612;
      --bg-2:#441033;
      --accent-1:#ff6b9a;
      --accent-2:#ffd1e8;
      --muted:#cdb7c6;
      --card: rgba(255,255,255,0.04);
      --pdf-text:#2a1222;
    }
    *{box-sizing:border-box; font-family: 'Poppins', system-ui, Arial; color: #fff; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}
    html,body{height:100%; margin:0; background: linear-gradient(180deg,var(--bg-1),var(--bg-2)); display:flex; align-items:center; justify-content:center; padding:18px; overflow:hidden;}
    .scene{
      width: min(980px, calc(100vw - 48px));
      border-radius:18px; overflow:hidden; position:relative;
      display:grid; grid-template-columns: 1fr 400px; gap:20px; padding:28px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      box-shadow: 0 24px 80px rgba(0,0,0,0.6);
      border: 1px solid rgba(255,255,255,0.03);
      max-height: calc(100vh - 36px);
    }
    .scene-inner{ overflow:auto; padding-right:6px; max-height: calc(100vh - 36px); }

    /* improved animated background */
    .bg-canvas{ position:absolute; inset:0; z-index:0; pointer-events:none; overflow:hidden; }
    .animated-sky{
      position:absolute; inset:-20% -20% -20% -20%; background:
        radial-gradient(600px 300px at 10% 20%, rgba(255,209,233,0.08), transparent 10%),
        radial-gradient(500px 220px at 90% 80%, rgba(255,107,154,0.06), transparent 8%),
        linear-gradient(120deg, rgba(255,107,154,0.02), transparent 40%);
      filter: blur(12px) saturate(120%); opacity:0.98; transform: translateZ(0);
      animation: floatBg 20s ease-in-out infinite;
    }
    @keyframes floatBg { 0%{ transform: translateY(0) rotate(0deg);} 50%{ transform: translateY(-5%) rotate(1.2deg);} 100%{ transform: translateY(0) rotate(0deg);} }

    .particle {
      position:absolute; width:8px; height:8px; border-radius:50%; opacity:0.12; background:linear-gradient(90deg,#fff,#ffd1e8);
      animation: drift linear infinite;
      will-change: transform, opacity;
    }
    @keyframes drift {
      from { transform: translateY(40vh) translateX(0) scale(.6); opacity:0; }
      10% { opacity:0.6; }
      to { transform: translateY(-30vh) translateX(40vw) scale(1.1); opacity:0; }
    }

    /* header, panels etc (unchanged aside from minor fixes) */
    .topbar{ grid-column:1 / -1; display:flex; justify-content:space-between; align-items:center; z-index:3; margin-bottom:6px;}
    .brand{ display:flex; gap:14px; align-items:center; }
    .logo{ width:64px; height:64px; border-radius:14px; display:flex; align-items:center; justify-content:center; font-size:28px; background:linear-gradient(135deg,#fff1,#ffdfe8); color: #6b1230; box-shadow: 0 8px 30px rgba(0,0,0,0.4); }
    h1{ margin:0; font-family:'Playfair Display', serif; font-size:20px; color:var(--accent-2); letter-spacing:0.2px; }
    p.lead{ margin:4px 0 0; color:var(--muted); font-size:13px; max-width:520px; }

    .panel{ background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:12px; padding:16px; box-shadow: 0 8px 28px rgba(0,0,0,0.5); z-index:3; border:1px solid rgba(255,255,255,0.02); }
    form{ display:contents; }
    .left{ display:flex; flex-direction:column; gap:12px; padding-right:6px; }
    .row{ display:flex; gap:12px; align-items:flex-start; }
    label{ display:block; font-weight:600; font-size:13px; color:var(--accent-2); margin-bottom:8px; font-family:'Poppins',sans-serif; }
    input, select, textarea{ width:100%; padding:12px 14px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background: rgba(255,255,255,0.02); color:#fff; font-size:14px; outline:none; }
    input::placeholder, textarea::placeholder{ color: rgba(255,255,255,0.35); }
    input:focus, select:focus, textarea:focus{ box-shadow: 0 12px 40px rgba(196,89,122,0.12); border-color: rgba(255,107,154,0.45); transform: translateY(-2px); }
    textarea{ min-height:120px; resize:vertical; font-size:14px; }

    select{ color:#fff; background: rgba(255,255,255,0.02); border-radius:10px; padding-right:36px; }
    select option{ color:#222; background:#fff; }

    .chips{ display:flex; gap:8px; flex-wrap:wrap; margin-top:6px; }
    .chip{ padding:9px 12px; border-radius:999px; background:transparent; border:1px solid rgba(255,255,255,0.03); color:var(--muted); cursor:pointer; font-weight:700; font-size:13px; transition: all .14s ease; }
    .chip[aria-pressed="true"]{ background: linear-gradient(90deg, rgba(255,107,154,0.14), rgba(255,209,233,0.03)); color:var(--accent-2); box-shadow:0 12px 34px rgba(255,107,154,0.06); transform: translateY(-2px); }

    .dealwrap{ display:flex; gap:14px; flex-wrap:wrap; color:var(--muted); }
    .dealwrap input{ accent-color: #ff6b9a; width:16px; height:16px; }

    aside.preview-col{ display:flex; flex-direction:column; gap:12px; }
    .profile-card{ display:flex; flex-direction:column; gap:12px; align-items:center; text-align:center; }
    .avatar{ width:200px; height:200px; border-radius:16px; overflow:hidden; display:flex; align-items:center; justify-content:center; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.03); box-shadow: 0 18px 60px rgba(0,0,0,0.6); position:relative; }
    .avatar img{ width:100%; height:100%; object-fit:cover; display:block; }
    .placeholder{ color:var(--muted); font-weight:700; padding:12px; }
    .pname{ font-family:'Playfair Display', serif; font-size:20px; font-weight:700; color:var(--accent-2); }
    .tag{ background: rgba(255,255,255,0.02); padding:6px 12px; border-radius:999px; color:var(--muted); font-weight:700; }

    .meter{ width:100%; height:16px; background: rgba(255,255,255,0.02); border-radius:999px; overflow:hidden; border:1px solid rgba(255,255,255,0.03); }
    .meter > i{ height:100%; width:0%; display:block; background: linear-gradient(90deg,#ffd1e8,#ff6b9a); transition: width .5s cubic-bezier(.22,.9,.2,1); box-shadow:0 12px 40px rgba(255,107,154,0.08); }

    .actions{ display:flex; gap:10px; justify-content:center; margin-top:6px; }
    .btn{ padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer; border:0; }
    .btn.primary{ background: linear-gradient(90deg,#ffd1e8,#ff6b9a); color:#2a1222; box-shadow:0 12px 36px rgba(255,107,154,0.12); }
    .btn.ghost{ background: transparent; border:1px solid rgba(255,255,255,0.06); color:var(--muted); }

    .compliment{ position:absolute; right:10px; top:-12px; background: #fff; color:#2b1222; padding:8px 12px; border-radius:999px; font-weight:700; transform:translateY(-10px) scale(.98); opacity:0; pointer-events:none; transition:all .35s ease; z-index:20; }
    .compliment.show{ transform:translateY(0) scale(1); opacity:1; }

    /* adult options improved visuals */
    .adult-grid{ display:flex; gap:8px; flex-wrap:wrap; margin-top:6px; opacity:0; transform:translateY(6px); transition: all .28s cubic-bezier(.2,.9,.2,1); }
    .adult-grid.visible{ opacity:1; transform:translateY(0); }
    .adult-pill{
      padding:10px 12px; border-radius:14px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.04);
      color:var(--muted); cursor:pointer; user-select:none; font-weight:700; display:inline-flex; gap:8px; align-items:center;
      transition: transform .12s ease, box-shadow .12s ease, background .12s ease, color .12s ease;
    }
    .adult-pill:hover{ transform: translateY(-4px); box-shadow:0 18px 40px rgba(255,107,154,0.06); color:var(--accent-2); }
    .adult-pill input{ accent-color:#ff6b9a; margin-right:6px; width:16px; height:16px; }
    .adult-pill.selected{ background: linear-gradient(90deg,#ffd1e8,#ff6b9a); color: #2a1222; box-shadow:0 18px 46px rgba(255,107,154,0.12); transform: translateY(-4px); }

    /* modal */
    .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:120; background: linear-gradient(rgba(6,4,12,0.6), rgba(6,4,12,0.6)); backdrop-filter: blur(4px); }
    .modal.show{ display:flex; }
    .sheet{ width:92%; max-width:720px; border-radius:12px; padding:20px; background: linear-gradient(180deg,#1d0f21,#2a1330); color:var(--muted); border:1px solid rgba(255,255,255,0.03); box-shadow:0 30px 90px rgba(0,0,0,0.7); transform:translateY(10px); animation: modalIn .28s ease; }
    @keyframes modalIn { from { opacity:0; transform:translateY(24px);} to { opacity:1; transform:translateY(0);} }
    .sheet h3{ margin:0 0 8px 0; font-family:'Playfair Display', serif; color:var(--accent-2); }

    .modal-card{ display:flex; gap:12px; align-items:center; }
    .modal-avatar{ width:96px; height:96px; border-radius:12px; overflow:hidden; background:#fff2; display:flex; align-items:center; justify-content:center; }
    .modal-body{ flex:1; }

    /* PDF template hidden area */
    .pdf-template{ display:none; width:800px; padding:28px; box-sizing:border-box; font-family:'Poppins',sans-serif; color:var(--pdf-text); background:white; border-radius:10px; }
    .pdf-header{ display:flex; align-items:center; gap:14px; margin-bottom:12px; }
    .pdf-header h2{ margin:0; font-family:'Playfair Display', serif; color:#9a2b4f; }
    .pdf-row{ display:flex; gap:12px; margin-bottom:10px; align-items:flex-start; }
    .pdf-row strong{ width:170px; display:inline-block; color:#8a2a47; }

    /* small responsive fix */
    @media (max-width:1000px){ .scene{ grid-template-columns: 1fr; } .avatar{ width:150px; height:150px; } }
  
/* --- Responsive dÃ¼zenlemeler --- */
@media (max-width: 800px) {
  html, body {
    padding: 8px;
    overflow: auto;
    align-items: flex-start;
  }
  .scene {
    display: flex;
    flex-direction: column;
    width: 100%;
    height: auto;
    max-height: none;
    padding: 16px;
  }
  .scene-inner {
    overflow: visible;
    max-height: none;
  }
  form {
    display: flex !important;
    flex-direction: column !important;
    gap: 16px !important;
  }
  .panel.left,
  aside.preview-col {
    width: 100% !important;
    padding: 12px !important;
  }
  .avatar {
    width: 140px !important;
    height: 140px !important;
  }
  .row {
    flex-direction: column;
  }
  input, select, textarea {
    font-size: 15px;
  }
  .btn {
    padding: 12px 16px;
    font-size: 15px;
  }
  .topbar {
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
  }
  .brand h1 {
    font-size: 18px;
  }
  p.lead {
    font-size: 12px;
  }
  .animated-sky {
    display: none; /* mobilde performans iÃ§in kapat */
  }
}
</style>
</head>
<body>
  <div class="scene" role="application" aria-labelledby="title">
    <div class="bg-canvas" aria-hidden="true">
      <div class="animated-sky"></div>
      <div class="particle" style="left:8%; top:80%; animation-duration:26s; background:rgba(255,209,233,0.08);"></div>
      <div class="particle" style="left:18%; top:55%; animation-duration:20s; background:rgba(255,107,154,0.07);"></div>
      <div class="particle" style="left:75%; top:70%; animation-duration:24s; background:rgba(255,209,233,0.06);"></div>
    </div>

    <div class="scene-inner" style="grid-column:1 / -1;">
      <div class="topbar">
        <div class="brand">
          <div class="logo">ğŸ’Œ</div>
          <div>
            <h1 id="title">Sevgili BaÅŸvuru Formu</h1>
            <p class="lead">Sunuma uygun, ÅŸÄ±k gÃ¶rÃ¼nÃ¼m. Doldurun, gÃ¶nderin; PDF indirmeyi manuel baÅŸlatÄ±n.</p>
          </div>
        </div>

        <div style="display:flex; gap:8px; align-items:center;">
          <button class="btn ghost" id="btnClearStorage" title="KaydedilmiÅŸ verileri temizle">Temizle</button>
        </div>
      </div>

      <form id="loveForm" novalidate style="display:grid; grid-template-columns: 1fr 400px; gap:20px; align-items:start;">
        <div class="panel left" style="height:100%;">
          <div class="row">
            <div style="flex:1">
              <label for="fullname">Ä°sim Soyisim</label>
              <input id="fullname" name="fullname" type="text" placeholder="AdÄ±nÄ±z SoyadÄ±nÄ±z" required />
              <div class="hint">GerÃ§ek ve samimi bilgiler daha iyi eÅŸleÅŸme saÄŸlar.</div>
            </div>
            <div style="width:120px;">
              <label for="age">YaÅŸ</label>
              <input id="age" name="age" type="text" placeholder="28" inputmode="numeric" />
            </div>
          </div>

          <div class="row">
            <div style="flex:1;">
              <label for="phone">Telefon (isteÄŸe baÄŸlÄ±)</label>
              <input id="phone" name="phone" type="tel" placeholder="+90 5xx xxx xx xx" />
            </div>
            <div style="width:260px;">
              <label for="email">Eâ€‘posta</label>
              <input id="email" name="email" type="email" placeholder="mail@ornekin.com" required />
            </div>
          </div>

          <div style="margin-top:6px;">
            <label for="lastReason">Sevgiliden en son ayrÄ±lma sebebi</label>
            <select id="lastReason" class="select-neutral" name="lastReason">
              <option value="">SeÃ§iniz</option>
              <option value="Ä°letiÅŸim eksikliÄŸi">Ä°letiÅŸim eksikliÄŸi</option>
              <option value="GÃ¼ven kaybÄ±">GÃ¼ven kaybÄ±</option>
              <option value="Uzak mesafe">Uzak mesafe</option>
              <option value="FarklÄ± gelecek hedefleri">FarklÄ± gelecek hedefleri</option>
              <option value="DiÄŸer">DiÄŸer</option>
            </select>
            <div class="hint">KÄ±sa bir aÃ§Ä±klama ile niyetinizi netleÅŸtirin.</div>
          </div>

          <div style="margin-top:12px;">
            <label for="criteria">AradÄ±ÄŸÄ±nÄ±z kriterler</label>
            <div class="chips" id="criteriaChips" role="list">
              <button type="button" class="chip" data-val="dÃ¼rÃ¼st" data-label="DÃ¼rÃ¼stlÃ¼k" aria-pressed="false">DÃ¼rÃ¼stlÃ¼k</button>
              <button type="button" class="chip" data-val="espri" data-label="Ä°yi mizah" aria-pressed="false">Ä°yi mizah</button>
              <button type="button" class="chip" data-val="sadakat" data-label="Sadakat" aria-pressed="false">Sadakat</button>
              <button type="button" class="chip" data-val="baÄŸÄ±msÄ±z" data-label="BaÄŸÄ±msÄ±zlÄ±k" aria-pressed="false">BaÄŸÄ±msÄ±zlÄ±k</button>
              <button type="button" class="chip" data-val="iletiÅŸim" data-label="Ä°letiÅŸim" aria-pressed="false">Ä°letiÅŸim</button>
              <button type="button" class="chip" data-val="destek" data-label="Destekleyici" aria-pressed="false">Destekleyici</button>
            </div>
            <div class="hint">En Ã§ok Ã¶nem verdiÄŸiniz 2â€“4 kriteri seÃ§in.</div>
          </div>

          <div style="margin-top:12px;">
            <label>Ã–nem verdiÄŸiniz "dealbreaker"lar</label>
            <div class="dealwrap">
              <label><input type="checkbox" name="dealbreakers" value="Åiddet" /> Åiddet</label>
              <label><input type="checkbox" name="dealbreakers" value="Aldatma" /> Aldatma</label>
              <label><input type="checkbox" name="dealbreakers" value="BaÄŸÄ±mlÄ±lÄ±klar" /> BaÄŸÄ±mlÄ±lÄ±klar</label>
              <label><input type="checkbox" name="dealbreakers" value="Ã‡ocuk istememe" /> Ã‡ocuk istememe</label>
            </div>
          </div>

          <div style="margin-top:12px;">
            <label for="qualities">AradÄ±ÄŸÄ±nÄ±z 3 ana Ã¶zellik (virgÃ¼lle ayÄ±rarak)</label>
            <input id="qualities" name="qualities" type="text" placeholder="Ã–rnek: anlayÄ±ÅŸlÄ±, dÃ¼rÃ¼st, esprili" />
          </div>

          <div style="margin-top:12px;">
            <label for="bio">Kendini tanÄ±tan kÄ±sa bio</label>
            <textarea id="bio" name="bio" placeholder="KÄ±sa, iÃ§ten ve gerÃ§ekÃ§i bir tanÄ±m yazÄ±n..."></textarea>
            <div class="hint">~150 karakter ideal: kÄ±sa, net ve iÃ§ten.</div>
          </div>

          <div style="margin-top:12px;">
            <label for="intent">Ä°liÅŸki niyeti</label>
            <select id="intent" class="select-neutral" name="intent">
              <option value="">SeÃ§iniz</option>
              <option value="Uzun vadeli ciddi iliÅŸki">Uzun vadeli ciddi iliÅŸki</option>
              <option value="TanÄ±ÅŸÄ±p gÃ¶rmek">TanÄ±ÅŸÄ±p gÃ¶rmek</option>
              <option value="Ã–nce arkadaÅŸlÄ±k">Ã–nce arkadaÅŸlÄ±k</option>
              <option value="DiÄŸer">DiÄŸer</option>
            </select>
            <div class="hint">Niyetinizi net yazmak karÅŸÄ± taraf iÃ§in Ã¶nemlidir.</div>
          </div>

          <div style="margin-top:12px;">
            <label for="frequency">BuluÅŸma sÄ±klÄ±ÄŸÄ± tercihi</label>
            <select id="frequency" name="frequency" class="select-neutral">
              <option value="">SeÃ§iniz</option>
              <option value="SÄ±k">SÄ±k</option>
              <option value="HaftalÄ±k">HaftalÄ±k</option>
              <option value="AylÄ±k">AylÄ±k</option>
              <option value="Sadece Ã¶zel durumlar">Sadece Ã¶zel durumlar</option>
            </select>
          </div>

          <div style="margin-top:12px;">
            <label>Hobiler (isteÄŸe baÄŸlÄ±)</label>
            <div class="dealwrap">
              <label><input type="checkbox" name="hobby" value="Seyahat" /> Seyahat</label>
              <label><input type="checkbox" name="hobby" value="MÃ¼zik" /> MÃ¼zik</label>
              <label><input type="checkbox" name="hobby" value="Spor" /> Spor</label>
              <label><input type="checkbox" name="hobby" value="Yemek" /> Yemek</label>
            </div>
          </div>

          <div style="margin-top:12px;">
            <div style="font-size:13px; color:var(--muted);">18+ seÃ§enekleri yalnÄ±zca yaÅŸ â‰¥ 18 olduÄŸunda gÃ¶rÃ¼nÃ¼r</div>
            <div id="adultOptions" style="display:block; margin-top:8px; border-radius:8px; padding:8px;">
              <div style="font-weight:700; color:var(--accent-2); margin-bottom:6px;">18+ SeÃ§enekler (isteÄŸe baÄŸlÄ±)</div>
              <div class="adult-grid" id="adultGrid">
                <label class="adult-pill"><input type="checkbox" name="adult" value="Gece HayatÄ±" /> Gece hayatÄ±</label>
                <label class="adult-pill"><input type="checkbox" name="adult" value="Romantik AkÅŸamlar" /> Romantik akÅŸamlar</label>
                <label class="adult-pill"><input type="checkbox" name="adult" value="Seyahat Partneri" /> Seyahat partneri</label>
                <label class="adult-pill"><input type="checkbox" name="adult" value="Ã–zel Aktiviteler" /> Ã–zel aktiviteler</label>
              </div>
            </div>
          </div>
        </div>

        <aside class="panel preview-col">
          <div class="profile-card">
            <div style="width:100%; text-align:left;">
              <div style="display:flex; justify-content:space-between; align-items:center;">
                <div>
                  <div class="pname" id="p_name">Ä°sim Soyisim</div>
                  <div id="p_tag" class="tag" style="margin-top:8px;">Profil bekleniyor</div>
                </div>
              </div>
            </div>

            <div class="avatar" id="avatarContainer" title="Profil fotoÄŸrafÄ±">
              <div class="compliment" id="complimentBubble" aria-hidden="true">GÃ¼zel seÃ§im!</div>
              <div class="placeholder" id="avatarPlaceholder">FotoÄŸraf sÃ¼rÃ¼kle veya yÃ¼kle</div>
              <img id="avatarImg" alt="avatar" src="" style="display:none;" />
            </div>

            <div style="width:100%; text-align:left;">
              <div class="meter" aria-hidden="true"><i id="progressBar"></i></div>
              <div style="display:flex; gap:8px; margin-top:10px; flex-wrap:wrap;">
                <div id="p_email" class="small" style="flex:1;">Eâ€‘posta: â€”</div>
                <div id="p_age" class="small">YaÅŸ: â€”</div>
              </div>
            </div>

            <div style="width:100%; display:flex; flex-direction:column; gap:8px; margin-top:8px;">
              <label for="photo" style="color:var(--accent-2); font-weight:600;">Profil FotoÄŸrafÄ± (isteÄŸe baÄŸlÄ±)</label>
              <input id="photo" type="file" accept="image/*" />
              <div class="actions">
                <button type="button" class="btn primary" id="btnSubmit">GÃ¶nder</button>
                <button type="button" class="btn ghost" id="btnReset">SÄ±fÄ±rla</button>
              </div>
              <div class="small">GÃ¶nder sonrasÄ± Ã¶zet gÃ¶rÃ¼nÃ¼r; PDF indirmeyi manuel baÅŸlatÄ±n.</div>
            </div>
          </div>
        </aside>
      </form>

      <div class="burst" id="burstContainer" aria-hidden="true"></div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal" id="resultModal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="sheet" role="document">
      <h3>BaÅŸvurunuz HazÄ±r ğŸ‰</h3>

      <div class="modal-card" style="margin-top:10px;">
        <div class="modal-avatar" id="modalAvatar">
          <img id="modalAvatarImg" src="" alt="avatar" style="width:100%; height:100%; object-fit:cover; display:none;" />
          <div id="modalAvatarPlaceholder" style="font-weight:700; color:#7a5a6a;">ğŸ’Œ</div>
        </div>

        <div class="modal-body">
          <div id="modalName" style="font-family:'Playfair Display', serif; font-size:18px; color:var(--accent-2); font-weight:700;">Ä°sim Soyisim</div>
          <div id="modalTag" style="margin-top:6px; color:var(--muted);">Profil bekleniyor</div>
          <div style="margin-top:10px;">
            <div class="meter" style="height:10px;"><i id="modalProgress" style="height:10px;"></i></div>
          </div>
        </div>
      </div>

      <div id="summary" style="margin-top:14px;"></div>
      <div id="pdfStatus" class="small" style="margin-top:8px; color:var(--muted);">PDF hazÄ±r deÄŸil. "PDF Ä°ndir" ile oluÅŸturun.</div>

      <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:14px;">
        <button class="btn ghost" id="closeModal">Kapat</button>
        <button class="btn primary" id="modalDownload" style="display:none;">PDF Ä°ndir</button>
        <button class="btn primary" id="copySummary">Ã–zet Kopyala</button>
      </div>
    </div>
  </div>

  <!-- Hidden PDF template (styled for print) -->
  <div id="pdfTemplate" class="pdf-template" aria-hidden="true">
    <div class="pdf-header">
      <div style="width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,#ffd1e8,#ff6b9a);display:flex;align-items:center;justify-content:center;font-size:28px;">ğŸ’Œ</div>
      <div>
        <h2 id="pdfName">Ä°sim Soyisim</h2>
        <div style="color:#a14a67;">Sevgili BaÅŸvuru Ã–zeti</div>
      </div>
    </div>

    <div id="pdfContent">
      <!-- Filled dynamically -->
    </div>

    <div style="margin-top:18px; font-size:12px; color:#7a6a78;">Sunum iÃ§in hazÄ±rlanmÄ±ÅŸtÄ±r â€” gizlilik: yerel cihazÄ±nÄ±zda oluÅŸturuldu.</div>
  </div>

  <!-- html2pdf bundle -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

  <script>
    const q = s => document.querySelector(s);
    const qa = s => Array.from(document.querySelectorAll(s));

    const form = q('#loveForm');
    const fullname = q('#fullname');
    const email = q('#email');
    const age = q('#age');
    const phone = q('#phone');
    const lastReason = q('#lastReason');
    const qualities = q('#qualities');
    const bio = q('#bio');
    const intent = q('#intent');
    const frequency = q('#frequency');
    const chips = qa('.chip');
    const progressBar = q('#progressBar');
    const p_name = q('#p_name');
    const p_tag = q('#p_tag');
    const p_email = q('#p_email');
    const p_age = q('#p_age');
    const photo = q('#photo');
    const avatarImg = q('#avatarImg');
    const avatarPlaceholder = q('#avatarPlaceholder');
    const avatarContainer = q('#avatarContainer');
    const complimentBubble = q('#complimentBubble');
    const modal = q('#resultModal');
    const summary = q('#summary');
    const btnSubmit = q('#btnSubmit');
    const btnReset = q('#btnReset');
    const closeModal = q('#closeModal');
    const copySummary = q('#copySummary');
    const btnClearStorage = q('#btnClearStorage');
    const burstContainer = q('#burstContainer');
    const pdfTemplate = q('#pdfTemplate');
    const pdfContent = q('#pdfContent');
    const pdfName = q('#pdfName');

    const modalDownload = q('#modalDownload');
    const modalAvatarImg = q('#modalAvatarImg');
    const modalAvatarPlaceholder = q('#modalAvatarPlaceholder');
    const modalName = q('#modalName');
    const modalTag = q('#modalTag');
    const modalProgress = q('#modalProgress');
    const pdfStatus = q('#pdfStatus');

    const adultOptions = q('#adultOptions');
    const adultGrid = q('#adultGrid');

    const LS_KEY = 'sevgili_form_v8';
    let lastComplimentTimeout = null;

    const compliments = [
      "Harika profil!", "GÃ¼lÃ¼ÅŸÃ¼n Ã§ok samimi âœ¨", "FotoÄŸraf enerjik ve sÄ±cak",
      "GÃ¶zler Ã§ok etkileyici", "DoÄŸallÄ±ÄŸÄ±n Ã§ok gÃ¼zel"
    ];

    function computeProgress(){
      const checks = [];
      checks.push(fullname.value.trim() !== '');
      checks.push(email.value.trim() !== '');
      checks.push(bio.value.trim() !== '');
      checks.push(intent.value !== '');
      checks.push(qualities.value.trim() !== '');
      checks.push(lastReason.value !== '');
      checks.push(chips.some(c => c.getAttribute('aria-pressed') === 'true'));
      checks.push(qa('input[name="dealbreakers"]:checked').length > 0);
      checks.push(photo.files && photo.files.length > 0);
      const filled = checks.filter(Boolean).length;
      return Math.round((filled / checks.length) * 100);
    }

    function updateProgressBar(){
      const pct = computeProgress();
      if(progressBar) progressBar.style.width = pct + '%';
      if(modalProgress) modalProgress.style.width = pct + '%';
      if(pct === 100) progressBar.style.transition = 'width .65s cubic-bezier(.18,.9,.2,1)';
      else progressBar.style.transition = 'width .35s ease';
    }

    function setChipState(el, state){
      el.setAttribute('aria-pressed', state ? 'true' : 'false');
      if(state) el.classList.add('active'); else el.classList.remove('active');
      saveToLocal();
    }

    chips.forEach(c=>{
      c.addEventListener('click', ()=> {
        const pressed = c.getAttribute('aria-pressed') === 'true';
        setChipState(c, !pressed);
        updatePreview();
      });
      c.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); c.click(); } });
    });

    photo.addEventListener('change', e=>{
      const f = e.target.files[0];
      if(!f) return;
      const url = URL.createObjectURL(f);
      avatarImg.src = url; avatarImg.style.display='block'; avatarPlaceholder.style.display='none';
      modalAvatarImg.src = url; modalAvatarImg.style.display = 'block'; modalAvatarPlaceholder.style.display = 'none';
      showCompliment();
      saveToLocal();
      updatePreview();
    });

    function showCompliment(){
      const text = compliments[Math.floor(Math.random()*compliments.length)];
      complimentBubble.textContent = text;
      complimentBubble.classList.add('show');
      if(lastComplimentTimeout) clearTimeout(lastComplimentTimeout);
      lastComplimentTimeout = setTimeout(()=> complimentBubble.classList.remove('show'), 2200);
    }

    // drag & drop
    avatarContainer.addEventListener('dragover', e => { e.preventDefault(); avatarContainer.style.opacity=0.95; });
    avatarContainer.addEventListener('dragleave', e => { avatarContainer.style.opacity=1; });
    avatarContainer.addEventListener('drop', e => {
      e.preventDefault(); avatarContainer.style.opacity=1;
      const f = e.dataTransfer.files && e.dataTransfer.files[0];
      if(f && f.type.startsWith('image/')) {
        photo.files = e.dataTransfer.files;
        const url = URL.createObjectURL(f);
        avatarImg.src = url; avatarImg.style.display='block'; avatarPlaceholder.style.display='none';
        modalAvatarImg.src = url; modalAvatarImg.style.display = 'block'; modalAvatarPlaceholder.style.display = 'none';
        showCompliment(); saveToLocal(); updatePreview();
      }
    });

    function validate(){ return fullname.value.trim() !== '' && email.checkValidity(); }

    function updatePreview(){
      p_name.textContent = fullname.value.trim() || 'Ä°sim Soyisim';
      p_email.textContent = 'Eâ€‘posta: ' + (email.value.trim() || 'â€”');
      p_age.textContent = 'YaÅŸ: ' + (age.value.trim() || 'â€”');
      const activeChips = chips.filter(c => c.getAttribute('aria-pressed') === 'true').map(c=> c.dataset.label || c.textContent.trim());
      p_tag.textContent = activeChips.length ? activeChips.join(' Â· ') : (intent.value || 'Profil bekleniyor');

      modalName.textContent = p_name.textContent;
      modalTag.textContent = p_tag.textContent;

      checkAdultOptions();
      updateProgressBar();
    }

    function gatherData(includeImage){
      const activeChips = chips.filter(c => c.getAttribute('aria-pressed') === 'true').map(c=> c.dataset.label || c.dataset.val);
      const dealbreakers = qa('input[name="dealbreakers"]:checked').map(i=>i.value);
      const hobbies = qa('input[name="hobby"]:checked').map(i=>i.value);
      const adult = qa('input[name="adult"]:checked').map(i=>i.value);
      const obj = {
        fullname: fullname.value.trim(),
        email: email.value.trim(),
        phone: phone.value.trim(),
        age: age.value.trim(),
        lastReason: lastReason.value,
        criteria: activeChips,
        dealbreakers,
        qualities: qualities.value.trim(),
        bio: bio.value.trim(),
        intent: intent.value,
        frequency: frequency.value || '',
        hobbies,
        adult,
        photoName: (photo.files[0] && photo.files[0].name) || ''
      };
      if(includeImage && avatarImg && avatarImg.src) obj.photoDataUrl = avatarImg.src;
      return obj;
    }

    function saveToLocal(){
      try{ localStorage.setItem(LS_KEY, JSON.stringify(gatherData(true))); }catch(e){}
    }

    function loadFromLocal(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(!raw) return;
        const d = JSON.parse(raw);
        fullname.value = d.fullname || ''; email.value = d.email || ''; phone.value = d.phone || '';
        age.value = d.age || ''; lastReason.value = d.lastReason || ''; qualities.value = d.qualities || '';
        bio.value = d.bio || ''; intent.value = d.intent || ''; frequency.value = d.frequency || '';
        chips.forEach(c => setChipState(c, d.criteria && d.criteria.includes(c.dataset.label || c.dataset.val)));
        if(d.dealbreakers) qa('input[name="dealbreakers"]').forEach(b => b.checked = d.dealbreakers.includes(b.value));
        if(d.hobbies) qa('input[name="hobby"]').forEach(h => h.checked = d.hobbies.includes(h.value));
        if(d.adult) qa('input[name="adult"]').forEach(a => a.checked = d.adult.includes(a.value));
        if(d.photoDataUrl){ avatarImg.src = d.photoDataUrl; avatarImg.style.display='block'; avatarPlaceholder.style.display='none'; modalAvatarImg.src = d.photoDataUrl; modalAvatarImg.style.display='block'; modalAvatarPlaceholder.style.display='none'; }
        // sync pill visuals
        qa('.adult-pill').forEach(label => {
          const inp = label.querySelector('input[type="checkbox"]');
          if(inp && inp.checked) label.classList.add('selected'); else label.classList.remove('selected');
        });
      }catch(e){}
    }

    function showBurst(){
      burstContainer.innerHTML = '';
      const count = 18;
      for(let i=0;i<count;i++){
        const b = document.createElement('div');
        b.className = 'b';
        const left = 45 + (Math.random()*30 - 15);
        const top = 40 + (Math.random()*30 - 15);
        b.style.left = left + '%'; b.style.top = top + '%';
        b.style.width = (8 + Math.random()*14) + 'px';
        b.style.height = b.style.width;
        b.style.background = `linear-gradient(90deg, ${['#ff9ab3','#ff6b81','#ffd1e8'][Math.floor(Math.random()*3)]}, #ff6b81)`;
        b.style.transform = `translate3d(0,0,0) rotate(${Math.random()*360}deg)`;
        b.style.opacity = 0;
        b.style.position = 'absolute';
        b.style.borderRadius = '4px';
        b.style.clipPath = 'polygon(50% 0%, 100% 35%, 82% 100%, 50% 80%, 18% 100%, 0% 35%)';
        b.style.animation = `pop 900ms forwards ${Math.random()*200}ms`;
        burstContainer.appendChild(b);
      }
      setTimeout(()=> burstContainer.innerHTML = '', 1400);
    }

    function showSummary(data){
      modal.classList.add('show'); modal.setAttribute('aria-hidden','false');
      summary.innerHTML = '';

      const addRow = (k,v)=> {
        const div = document.createElement('div'); div.style.display='flex'; div.style.gap='12px'; div.style.marginBottom='8px';
        div.innerHTML = `<strong style="width:160px; color:#ffd0e6;">${k}</strong><div style="flex:1">${escapeHtml(v)}</div>`;
        summary.appendChild(div);
      };

      addRow('Ä°sim', data.fullname || 'â€”');
      addRow('Eâ€‘posta', data.email || 'â€”');
      addRow('Telefon', data.phone || 'â€”');
      addRow('YaÅŸ', data.age || 'â€”');
      addRow('En son ayrÄ±lma sebebi', data.lastReason || 'â€”');
      addRow('Kriterler', (data.criteria && data.criteria.length) ? data.criteria.join(', ') : 'â€”');
      addRow('Dealbreaker\'lar', (data.dealbreakers && data.dealbreakers.length) ? data.dealbreakers.join(', ') : 'â€”');
      addRow('3 Ana Ã–zellik', data.qualities || 'â€”');
      addRow('Bio', data.bio || 'â€”');
      addRow('Niyet', data.intent || 'â€”');
      addRow('BuluÅŸma sÄ±klÄ±ÄŸÄ±', data.frequency || 'â€”');
      addRow('Hobiler', (data.hobbies && data.hobbies.length) ? data.hobbies.join(', ') : 'â€”');
      addRow('18+ tercihler', (data.adult && data.adult.length) ? data.adult.join(', ') : 'â€”');
      addRow('FotoÄŸraf', data.photoName || 'YÃ¼klenmedi');

      modalDownload.style.display = 'inline-block';
      pdfStatus.textContent = 'PDF hazÄ±r deÄŸil. "PDF Ä°ndir" ile oluÅŸturun.';
    }

    function escapeHtml(s){ return String(s || '').replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

    btnSubmit.addEventListener('click', async ()=>{
      if(!validate()){ alert('LÃ¼tfen isim ve geÃ§erli bir eâ€‘posta girin.'); return; }
      const data = gatherData(true);
      saveToLocal();
      localStorage.setItem(LS_KEY + '_submitted','true');
      updatePreview();
      showBurst();
      showSummary(data);
      // automatic PDF generation removed
    });

    closeModal.addEventListener('click', ()=> { modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); });

    copySummary.addEventListener('click', ()=> {
      navigator.clipboard.writeText(summary.innerText).then(()=> {
        copySummary.textContent = 'KopyalandÄ±!'; setTimeout(()=> copySummary.textContent = 'Ã–zet Kopyala',1400);
      });
    });

    btnReset.addEventListener('click', ()=> {
      form.reset();
      chips.forEach(c => setChipState(c,false));
      avatarImg.src=''; avatarImg.style.display='none'; avatarPlaceholder.style.display='block';
      modalAvatarImg.src=''; modalAvatarImg.style.display='none'; modalAvatarPlaceholder.style.display='block';
      localStorage.removeItem(LS_KEY + '_submitted');
      updatePreview(); saveToLocal();
    });

    modalDownload.addEventListener('click', ()=> {
      const data = gatherData(true);
      pdfStatus.textContent = 'PDF oluÅŸturuluyor...';
      generatePDF(data).then(()=> pdfStatus.textContent = 'PDF oluÅŸturuldu. Ä°ndirme baÅŸladÄ±.' ).catch(()=> pdfStatus.textContent = 'OluÅŸturulamadÄ±. Tekrar deneyin.');
    });

    function generatePDF(data){
      return new Promise((resolve, reject) => {
        try{
          // ensure arrays converted to strings
          const safe = (v) => Array.isArray(v) ? v.join(', ') : (v === undefined || v === null || v === '' ? 'â€”' : v);

          pdfName.textContent = safe(data.fullname) || 'Ä°sim Soyisim';
          pdfContent.innerHTML = '';
          const addPdfRow = (k,v) => {
            const div = document.createElement('div'); div.className='pdf-row';
            const left = document.createElement('strong'); left.textContent = k;
            const right = document.createElement('div'); right.style.flex = '1'; right.textContent = safe(v);
            div.appendChild(left); div.appendChild(right);
            pdfContent.appendChild(div);
          };
          addPdfRow('Ä°sim', data.fullname);
          addPdfRow('Eâ€‘posta', data.email);
          addPdfRow('Telefon', data.phone);
          addPdfRow('YaÅŸ', data.age);
          addPdfRow('AyrÄ±lma sebebi', data.lastReason);
          addPdfRow('Kriterler', data.criteria);
          addPdfRow('Dealbreaker\'lar', data.dealbreakers);
          addPdfRow('3 Ana Ã–zellik', data.qualities);
          addPdfRow('Bio', data.bio);
          addPdfRow('Niyet', data.intent);
          addPdfRow('BuluÅŸma sÄ±klÄ±ÄŸÄ±', data.frequency);
          addPdfRow('Hobiler', data.hobbies);
          addPdfRow('18+ tercihler', data.adult);

          if(data.photoDataUrl){
            const imgDiv = document.createElement('div'); imgDiv.style.marginTop='12px';
            const img = document.createElement('img'); img.src = data.photoDataUrl;
            img.style.maxWidth = '180px'; img.style.borderRadius = '8px'; img.style.display = 'block'; img.style.border = '1px solid #f1d8e3';
            imgDiv.appendChild(img);
            pdfContent.appendChild(imgDiv);
          }

          // make template visible for html2pdf rendering
          pdfTemplate.style.display = 'block';
          // force plain fonts and color for PDF template
          pdfTemplate.style.color = '#2a1222';
          // small delay to allow DOM paint
          setTimeout(()=> {
            const opt = {
              margin:       [10,10,10,10],
              filename:     (data.fullname ? String(data.fullname).replace(/\s+/g,'_') : 'sevgili_basvuru') + '.pdf',
              image:        { type: 'jpeg', quality: 0.95 },
              html2canvas:  { scale: 2, useCORS: true, logging:false },
              jsPDF:        { unit: 'pt', format: 'a4', orientation: 'portrait' }
            };
            html2pdf().set(opt).from(pdfTemplate).save().then(()=> {
              pdfTemplate.style.display = 'none';
              resolve();
            }).catch(err=>{
              pdfTemplate.style.display = 'none';
              reject(err);
            });
          }, 120);
        }catch(e){
          reject(e);
        }
      });
    }

    btnClearStorage.addEventListener('click', ()=> {
      if(confirm('KaydedilmiÅŸ verileri ve gÃ¶nderme iÅŸaretini silmek istiyor musunuz?')){
        localStorage.removeItem(LS_KEY); localStorage.removeItem(LS_KEY + '_submitted');
        form.reset(); chips.forEach(c=> setChipState(c,false) ); avatarImg.src=''; avatarImg.style.display='none'; avatarPlaceholder.style.display='block';
        modalAvatarImg.src=''; modalAvatarImg.style.display='none'; modalAvatarPlaceholder.style.display='block';
        modalDownload.style.display='none'; updatePreview(); alert('Veriler temizlendi.');
      }
    });

    function checkAdultOptions(){
      const ageVal = parseInt((age.value||'').replace(/[^\d]/g,''),10);
      const visible = (!isNaN(ageVal) && ageVal >= 18);
      // show/hide with animation
      if(visible){
        adultGrid.classList.add('visible');
        // allow the grid to be seen
        adultOptions.style.opacity = '1';
      } else {
        adultGrid.classList.remove('visible');
        // clear selections if hidden
        qa('input[name="adult"]').forEach(a => a.checked = false);
        qa('.adult-pill').forEach(label => label.classList.remove('selected'));
      }
    }

    // update pill selected visuals when user toggles an adult checkbox
    qa('.adult-pill').forEach(label=>{
      const inp = label.querySelector('input[type="checkbox"]');
      if(!inp) return;
      inp.addEventListener('change', ()=> {
        if(inp.checked) label.classList.add('selected'); else label.classList.remove('selected');
        saveToLocal(); updatePreview();
      });
      // allow clicking the whole pill to toggle
      label.addEventListener('click', (e)=>{
        if(e.target.tagName === 'INPUT') return;
        inp.checked = !inp.checked;
        inp.dispatchEvent(new Event('change', { bubbles: true }));
      });
    });

    age.addEventListener('input', ()=> { checkAdultOptions(); saveToLocal(); updatePreview(); });

    ['input','change'].forEach(ev=>{
      [fullname,email,age,bio,intent,qualities,lastReason,phone,frequency].forEach(el=>{
        el.addEventListener(ev, ()=>{ updatePreview(); saveToLocal(); });
      });
    });
    qa('input[name="dealbreakers"]').forEach(i=> i.addEventListener('change', ()=> { saveToLocal(); updatePreview(); }));
    qa('input[name="hobby"]').forEach(i=> i.addEventListener('change', ()=> { saveToLocal(); updatePreview(); }));

    // init
    loadFromLocal();
    // ensure adultOptions hidden until age checked
    checkAdultOptions();
    updatePreview();
  </script>
</body>
</html>
